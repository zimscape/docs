image: vusakhoza/python:3.6
variables:
  LC_ALL: "C.UTF-8"
  LANG: "C.UTF-8"

stages:
  - package
  - staging

before_script:
  - 'which ssh-agent || ( apt-get update -y && apt-get install openssh-client -y )'
  - eval $(ssh-agent -s)
  - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add -
  - mkdir -p ~/.ssh
  - chmod 700 ~/.ssh
  - ssh-keyscan $STAGING_IP >> ~/.ssh/known_hosts
  - chmod 644 ~/.ssh/known_hosts

package:
  stage: package
  script:
    - pip install mkdocs
    - pip install mkdocs-material
    - mkdocs build

staging:
  stage: staging
  image: vusakhoza/nodejs:12
  before_script:
    - npm install -g zimscape-cli
    - mkdir -p ~/.zimscape/cli/data
    - cat $ZS_TOKEN >> ~/.zimscape/cli/data/access_token
  script:
    - zimscape push docs.zimscape.com
